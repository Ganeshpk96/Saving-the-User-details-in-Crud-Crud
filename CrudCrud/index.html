<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objects in Local Storage</title>
    <!-- <h1>Objects in Local Storage</h1> -->
</head>
<body>
    <!-- <form onsubmit="saveToLocalStorage(event)">
    <label>Name</label>
    <input type="text" name = "username" required/>
    <label>emailId</label>
    <input type="email" name = "emailId" required/>
    <label>Phone Number</label>
    <input type="tel" name = "phonenumber" required/>
    <button type="submit">Submit</button>
</form> -->
<h1>Appointment Booking App</h1>
    <form action="#">
      <input type="text" id="name" required />
      <input type="email" id="email" required />
      <input type="submit" id="submit" value="Submit" />
    </form>
    <ul id="listOfPeople"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js"></script>

    <script>
        const submitButton = document.getElementById("submit");

document.addEventListener("DOMContentLoaded", () => {
  // console.log("vscode");

});
      
        submitButton.addEventListener("click", (e) => {
  e.preventDefault();
  const emailId = document.getElementById("email").value;
  const name = document.getElementById("name").value;
  if (emailId.length > 0 && name.length > 0) {
    const object = {
      name: name,
      emailId: emailId //unique
    };
      console.log(object);
//       var data = JSON.stringify({
//   "name": "Ganesh",
//   "emailid": "john@gmail.com",
//   "age": 25
// });
    axios.post("https://crudcrud.com/api/48e6f46cae574751bdaaf24ea9fa7ee2/Appointmentdata",object)
.then((response) => {
  console.log(response)
})
.catch((err) => {
  console.log(err)
})

    localStorage.setItem("userDetails" + emailId, JSON.stringify(object));
    // localStorage.setItem("userDetailEmail" + emailId, emailId);
    // listOfPeople.push(object)
    addNewLineElement(object);
  }
});

// axios.post("https://crudcrud.com/api/48e6f46cae574751bdaaf24ea9fa7ee2/Appointmentdata"+ object)
// .then((response) => {
//   console.log(response)
// })
// .catch((err) => {
//   console.log(err)
// })

function addNewLineElement(object) {
  const ul = document.getElementById("listOfPeople");
  const li = document.createElement("li");
  li.appendChild(
    document.createTextNode(object.name + " " + object.emailId + " ")
  );
  // li.appendChild()
  console.log(document.createElement("i"));
  const a1 = document.createElement("input");
  a1.id = "yash";
  a1.type = "button";
  a1.value = "Edit";
  a1.addEventListener("click", () => {
    console.log(object);
    document.getElementById("name").value = object.name;
    document.getElementById("email").value = object.emailId;
    li.remove();
  });
  a1.className = "delete";
  a1.style.border = "2px solid green";
  console.log(a1);
  li.appendChild(a1);

  const a = document.createElement("input");
  a.type = "button";
  a.value = "delete";
  a.addEventListener("click", () => {
    localStorage.removeItem("userDetails" + object.emailId);
    // axios.delete(`${apiendpoint}/registeruser/${object._id}`);
    li.remove();
  });
  a.className = "delete";
  a.style.border = "2px solid red";
  console.log(a);
  li.appendChild(a);
  console.log(li);

  ul.appendChild(li);
}

        function onLoad(){
            var get = JSON.parse(localStorage.getItem("ganeshpk96@gmail.com"))
            console.log(get);
        }
        onLoad();
        if (document.readyState !== "loading") {
  console.log("vscode");

  var keys = Object.keys(localStorage), //taking out all the keys that are there in the local storage
    i = keys.length; //6
  console.log("keys", keys);
  let stringifiedDetailsOfPeople, detailsOfPeople;

  // 6 to 0
  Object.keys(localStorage).forEach((key) => {
    //i==2
    if (key.match(/userDetails/g)) {
      //we only care about keys that start with userDetails
      //this is called regex matching
      stringifiedDetailsOfPeople = localStorage.getItem(key);
      console.log("stringifiedDetailsOfPeople", stringifiedDetailsOfPeople);
      detailsOfPeople = JSON.parse(stringifiedDetailsOfPeople);
      console.log("details", detailsOfPeople);

      addNewLineElement(detailsOfPeople);
    }
  });
}
    </script>
    <script src="localstorage.js">
    
    </script>
</body>
</html>